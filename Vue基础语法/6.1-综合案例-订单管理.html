<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <!-- <link
      href="https://cdn.bootcss.com/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
      rel="stylesheet"
    /> -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <title>综合案例——订单管理</title>
  </head>

  <body>
    <div id="app">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
          <a href="#" class="navbar-brand">订单管理</a>
        </div>
      </nav>
      <div class="container overflow-hidden">
        <div class="row gy-5">
          <div class="col-md-8">
            <div class="p-3 border bg-light">
              <label for="brand" class="col-md-4">
                品牌：<input type="text" id="brand" v-model="brandQueryParam" />
              </label>
              <button
                type="button"
                class="btn btn-primary gx-15"
                @click="queryByBrand()"
              >
                查询
              </button>
            </div>

            <div class="p-3 gy-5">
              <table class="table table-bordered table-hover table-striped">
                <thead>
                  <tr>
                    <th>品牌</th>
                    <th>订单日期</th>
                    <th>订单价格（万元）</th>
                    <th>购买数量</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(item,index) in orders" :key="item.id">
                    <td>{{item.brand}}</td>
                    <td>{{item.orderDate}}</td>
                    <td>{{item.price}}</td>
                    <td>
                      <button @click="incr(index)">+</button>
                      {{item.num}}
                      <button
                        @click="decr(index)"
                        v-bind:disabled="item.num <= 1"
                      >
                        -
                      </button>
                    </td>
                    <td><button @click="delOrder(index)">删除</button></td>
                  </tr>
                </tbody>

                <tfoot>
                  <tr>
                    <th>订单总额为{{totalPrice}}万元</th>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <div class="col-md-4">
            <legend>新增订单</legend>

            <div class="form-group">
              <label>品牌</label>
              <input
                v-model="brand"
                type="text"
                class="form-control"
                placeholder="如：宝马，奔驰"
              />
            </div>
            <div class="form-group">
              <label>价格（万元）</label>
              <input
                v-model="price"
                type="text"
                class="form-control"
                placeholder="如：50"
              />
            </div>
            <div class="form-group">
              <label>数量</label>
              <input
                v-model="num"
                type="text"
                class="form-control"
                placeholder="如：3"
              />
            </div>

            <button @click="addOrder" type="submit" class="btn btn-primary">
              提交
            </button>
          </div>
        </div>
      </div>
      <!-- <div class="container">
        <div class="panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title">订单管理</h3>
          </div>
          <div class="panel-body">
            <label for="brand" class="col-sm-2">
              品牌：<input type="text" id="brand" v-model="brandQueryParam" />
            </label>

            <button
              type="button"
              class="btn btn-primary"
              @click="queryByBrand()"
            >
              查询
            </button>
          </div>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
          <table class="table table-bordered table-hover table-striped">
            <thead>
              <tr>
                <th>品牌</th>
                <th>订单日期</th>
                <th>订单价格（万元）</th>
                <th>购买数量</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(item,index) in orders" :key="item.id">
                <td>{{item.brand}}</td>
                <td>{{item.orderDate}}</td>
                <td>{{item.price}}</td>
                <td>
                  <button @click="incr(index)">+</button>
                  {{item.num}}
                  <button @click="decr(index)" v-bind:disabled="item.num <= 1">
                    -
                  </button>
                </td>
                <td><button @click="delOrder(index)">删除</button></td>
              </tr>
            </tbody>

            <tfoot>
              <tr>
                <th>订单总额为{{totalPrice}}万元</th>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
          <legend>新增订单</legend>

          <div class="form-group">
            <label>品牌</label>
            <input
              v-model="brand"
              type="text"
              class="form-control"
              placeholder="如：宝马，奔驰"
            />
          </div>
          <div class="form-group">
            <label>价格（万元）</label>
            <input
              v-model="price"
              type="text"
              class="form-control"
              placeholder="如：50"
            />
          </div>
          <div class="form-group">
            <label>数量</label>
            <input
              v-model="num"
              type="text"
              class="form-control"
              placeholder="如：3"
            />
          </div>

          <button @click="addOrder" type="submit" class="btn btn-primary">
            提交
          </button>
        </div>
      </div> -->
    </div>

    <script src="https://unpkg.com/vue@next"></script>

    <script type="module">
      import formatDate from "./js/module.js";
      let app = Vue.createApp({
        data() {
          return {
            id: 0, //订单id
            brand: "", //订单品牌
            price: 0, //订单价格
            num: 0, //订单数量
            orders: [
              {
                id: 1,
                brand: "宝马",
                orderDate: formatDate(new Date()),
                price: 50,
                num: 3,
              },
              {
                id: 2,
                brand: "奔驰",
                orderDate: formatDate(new Date()),
                price: 80,
                num: 5,
              },
            ],
            brandQueryParam: "", //查询参数：品牌
          };
        },
        computed: {
          totalPrice() {
            return this.orders.reduce(function (preValue, item) {
              return preValue + item.price * item.num;
            }, 0);
          },
        },
        methods: {
          delOrder(index) {
            this.orders.splice(index, 1);
          },
          incr(index) {
            console.log(index);
            this.orders[index].num++;
          },
          decr(index) {
            this.orders[index].num--;
          },
          addOrder() {
            this.orders.push({
              id: this.id++,
              brand: this.brand,
              orderDate: new Date(),
              price: this.price,
              num: this.num,
            });
            this.brand = "";
            this.price = this.num = 0;
          },
          queryByBrand() {
            // let _this = this
            // this.orders = this.orders.filter(function(item){
            //   return item.brand.includes(_this.brandQueryParam);
            // })
            this.orders = this.orders.filter((item) => {
              return item.brand.includes(this.brandQueryParam);
            });
          },
        },
      });
      let vm = app.mount("#app");
    </script>
  </body>

  <html></html>
</html>
